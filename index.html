<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Monster Ecology Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Monster Ecology Explorer</h1>
    <p>
      Use the controls below to explore how D&amp;D monsters are distributed
      across environments, types, and sizes – and how their stats, movement
      abilities, and resistances change with challenge rating (how strong they are).
    </p>
  </header>

  <main>
    <section id="explorer-section">
      <h2>Explore monsters by group and metric</h2>

      <div id="controls" class="controls-panel">
        <div class="control-group">
          <label for="dimension-select">Group by</label>
          <select id="dimension-select">
            <option value="environment">Environment</option>
            <option value="type">Monster type</option>
            <option value="size">Size</option>
          </select>
        </div>

        <div class="control-group">
          <label for="metric-select">Metric</label>
          <select id="metric-select">
            <option value="count">Number of monsters</option>
            <option value="avgCR">Average CR</option>
            <option value="avgHP">Average HP</option>
            <option value="avgAC">Average AC</option>
            <option value="pctFly">% that can fly</option>
            <option value="pctSwim">% that can swim</option>
          </select>
        </div>

        <div class="control-group cr-group">
          <label>CR range</label>
          <div class="cr-inputs">
            <input type="number" id="cr-min" step="0.25" />
            <span>to</span>
            <input type="number" id="cr-max" step="0.25" />
          </div>
          <small id="cr-range-note"></small>
        </div>

        <div class="control-group toggles-group">
          <label>Movement filters</label>
          <div class="checkbox-row">
            <label>
              <input type="checkbox" id="fly-filter" />
              Only monsters that can fly
            </label>
          </div>
          <div class="checkbox-row">
            <label>
              <input type="checkbox" id="swim-filter" />
              Only monsters that can swim
            </label>
          </div>
        </div>
      </div>

      <p id="explorer-caption" class="caption">
        Each bar shows the <strong>number of monsters</strong> in each
        <strong>environment</strong>, filtered by the CR range and movement
        options above. Change the options to see how the picture shifts.
      </p>

      <div id="explorer-chart" class="chart-container"></div>
      <p id="explorer-summary" class="summary-text">
        Loading data…
      </p>
    </section>

    <!-- Linked stats vs CR scatterplot -->
    <section id="stats-section">
      <h2>Stats vs challenge rating</h2>
      <p>
        This view shows how monster stats scale with challenge rating. It uses
        the same CR range and movement filters as the bar chart above. Clicking
        a bar focuses the scatterplot on that group.
      </p>

      <div class="controls-panel stats-controls">
        <div class="control-group">
          <label for="stat-select">Stat</label>
          <select id="stat-select">
            <option value="hp">Hit Points</option>
            <option value="ac">Armor Class</option>
            <option value="str">Strength</option>
            <option value="dex">Dexterity</option>
            <option value="con">Constitution</option>
            <option value="int">Intelligence</option>
            <option value="wis">Wisdom</option>
            <option value="cha">Charisma</option>
          </select>
        </div>

        <div class="control-group">
          <label>Current selection</label>
          <div id="stats-group-label" class="group-pill">
            All monsters (filtered)
          </div>
        </div>
      </div>

      <div id="stats-chart" class="chart-container"></div>
      <p id="stats-caption" class="caption">
        Each point is a monster. The line shows a simple best-fit trend for the
        chosen stat vs CR.
      </p>
    </section>

          <!-- Damage defenses vs ecology heatmap -->
    <section id="defense-section">
      <h2>Damage defenses by environment, type, or size</h2>
      <p>
        This heatmap shows how common different damage defenses are across
        monster groups. Use the CR range and movement filters above, then
        choose a defense type and grouping to see where certain resistances
        or immunities cluster.
      </p>

      <div class="controls-panel stats-controls">
        <div class="control-group">
          <label for="defense-kind-select">Defense kind</label>
          <select id="defense-kind-select">
            <option value="resist">Resistances</option>
            <option value="immune">Immunities</option>
            <option value="vuln">Vulnerabilities</option>
          </select>
        </div>

        <div class="control-group">
          <label for="defense-group-select">Group by</label>
          <select id="defense-group-select">
            <option value="environment">Environment</option>
            <option value="type">Monster type</option>
            <option value="size">Size</option>
          </select>
        </div>
      </div>

      <div id="defense-heatmap" class="chart-container"></div>
      <p id="defense-heatmap-caption" class="caption">
        Each cell shows the percentage of monsters in a group that have the
        chosen kind of damage defense against a given damage type.
      </p>
    </section>

  </main>

  <footer>
    <p>
      Data: Open5e monsters, cleaned into <code>monsters_ecology.csv</code>.
      Built with D3.js.
    </p>
  </footer>

  <div id="tooltip" class="tooltip" style="opacity:0;"></div>

  <script src="main.js"></script>
</body>
</html>
